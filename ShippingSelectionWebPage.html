<!DOCTYPE html>
<html lang="en">
<!--HTML, CSS, and Bootstrap, Author: Marcos Ruiz-->
<!--Javascript and minor HTML done by: Alex Hammond-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shipping Information</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{--bg:#f8f9fb;--card:#fff;--muted:#6c757d}
        body{background:var(--bg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;padding:28px 12px}
        .card-area{max-width:800px;margin:0 auto;background:var(--card);border-radius:10px;padding:20px;box-shadow:0 8px 30px rgba(17,24,39,0.06);border:1px solid #e9eef5}
        h1{font-size:1.25rem;margin-bottom:8px}
        .lead{color:var(--muted);margin-bottom:12px}
        .form-label.required::after{content:" *";color:#d63384}
    </style>
</head>
<body ng-app="shippingApp">

    <div class="card-area">
        <header class="mb-3">
            <h1>Shipping Carrier Information</h1>
        </header>

        <form id="shippingForm">
            <div class="row g-3">
                <div class="col-12">
                    <label for="address" class="form-label required">Address</label>
                    <input id="address" type="text" class="form-control" placeholder="Address">
                </div>
                <div class="col-6 col-md-4">
                    <label for="city" class="form-label required">City</label>
                    <input id="city" type="text" class="form-control" placeholder="City">
                </div>
                <div class="col-3 col-md-2">
                    <label for="state" class="form-label required">State</label>
                    <input id="state" type="text" class="form-control" placeholder="State">
                </div>
                <div class="col-4 col-md-3">
                    <label for="zip" class="form-label required">ZIP Code</label>
                    <input id="zip" type="number" class="form-control" placeholder="ZIP Code">
                </div>

                <div class="col-6">
                    <label for="carrier" class="form-label required">Shipping Carrier</label>
                    <select id="carrier" class="form-select">
                        <option>FedEx</option>
                        <option>UPS</option>
                        <option>DHL</option>
                    </select>
                </div>
                <div class="col-6">
                    <label for="method" class="form-label required">Shipping Method</label>
                    <select id="method" class="form-select">
                        <option>Ground</option>
                        <option>2nd Day</option>
                        <option>Overnight</option>
                    </select>
                </div>

                <div class="col-12 text-start mt-2">
                    <a href="#" id="backToCheckout" class="btn btn-secondary">Back to Checkout</a>
                </div>

                <div class="col-12 text-end mt-2">
                    <a href="index.html" class="btn btn-outline-secondary me-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </form>
    </div>
    <script>
        const Zip = document.getElementById('zip');
        Zip.addEventListener('input', function() {
            this.value = this.value.replace(/\D/g, '').slice(0, 10);
        });
        // Handle shipping form submission
        document.getElementById("shippingForm").addEventListener("submit", function(e) {
            e.preventDefault();

            const tempOrder = JSON.parse(localStorage.getItem("tempOrder"));
            if (!tempOrder) {
                alert("No order found. Please go back to your cart and checkout again.");
                window.location.href = "ShoppingCartWebPage.html";
                return;
            }

            // Collect shipping data
            const address = document.getElementById("address").value.trim();
            const city = document.getElementById("city").value.trim();
            const state = document.getElementById("state").value.trim();
            const zip = document.getElementById("zip").value.trim();
            const carrier = document.getElementById("carrier").value;
            const method = document.getElementById("method").value;

            // --- Validation check ---
            if (!address || !city || !state || !zip || !carrier || !method) {
                alert("Please fill in all required fields before submitting.");
                return; // stop submission
            }

            const shippingData = { address, city, state, zip, carrier, method };

            // Add shipping info and update order status
            tempOrder.shipping = shippingData;
            tempOrder.status = "submitted";

            // Retrieve existing orders, append this one, then save
            const existingOrders = JSON.parse(localStorage.getItem("orders") || "[]");
            existingOrders.push(tempOrder);
            localStorage.setItem("orders", JSON.stringify(existingOrders));

            // Remove temporary order
            localStorage.removeItem("tempOrder");

            // Confirmation and redirect
            alert(`Order #${tempOrder.orderId} submitted successfully with shipping details!`);
            window.location.href = "index.html";
        });

        document.getElementById('backToCheckout').addEventListener('click', (e) => {
            e.preventDefault(); // prevent default link behavior
            const cartData = localStorage.getItem("cartData");

            if (cartData) {
                // Flag the checkout page to restore the cart
                sessionStorage.setItem("restoreCart", "true");
            }

            // Redirect back to Shopping Cart page
            window.location.href = "ShoppingCartWebPage.html";
        });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
</body>
</html>
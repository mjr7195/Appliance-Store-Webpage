<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Product Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{--bg:#f8f9fb;--card:#ffffff;--muted:#6c757d;}
        body{background:var(--bg);padding:28px 12px;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
        .card-area{max-width:920px;margin:0 auto;background:linear-gradient(180deg,var(--card),#fbfbfd);border-radius:10px;padding:22px;box-shadow:0 8px 30px rgba(17,24,39,0.06);border:1px solid #e9eef5;}
        label.required::after{content:" *";color:#d63384}
    </style>
</head>
<body>
    <div class = "card-area">
        <header class="mb-3"><h1>Product Management:</h1></header>
        <form id="ProductForm" class="row g-3" novalidate>
            <div class="col-12 col-md-6">
                <label for="productID" class="form-label required">Product ID</label>
                <input type="number" class="form-control" id="productID" placeholder="Enter product ID" required>
            </div>
            <div class="col-12 col-md-6">
                <label for="productName" class="form-label required">Product Name</label>
                <input type="text" class="form-control" id="productName" placeholder="Enter Product Name" required>
            </div>
            <div class="col-12 col-md-6">
                <label for="productDescription" class="form-label required">Product Description</label>
                <input type="text" class="form-control" id="productDescription" required>
            </div>
            <div class="col-12 col-md-4">
                <label for="productCategory" class="form-label required">Category</label>
                <select id="productCategory" class="form-control" required>
                    <option value="">-- Select --</option>
                    <option value="Refrigerators">Refrigerators</option>
                    <option value="Washers">Washers</option>
                    <option value="Dryers">Dryers</option>
                    <option value="Microwaves">Microwaves</option>
                    <option value="Accessories">Accessories</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <label for="productUnitofMeasure" class="form-label required">UoM</label>
                <select id="productUnitofMeasure" class="form-control" required>
                    <option value="">-- Select --</option>
                    <option value="Each">Each</option>
                    <option value="Box">Box</option>
                    <option value="Pallet">Pallet</option>
                </select>
            </div>
            <div class="col-12 col-md-3">
                <label for="productPrice" class="form-label required">Price</label>
                <input type="text" class="form-control" id="productPrice" placeholder="10.00" required>
            </div>
            <div class="col-12 col-md-2">
                <label for="productWeight" class="form-label">Weight (lbs)</label>
                <input type="text" class="form-control" id="productWeight">
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Submit New Product</button>
            </div>
            <div class="col-12">
                <button type="button" class="btn btn-secondary" id="returnHome">Return to Home</button>
            </div>
        </form>

        <section class="mt-4">
            <h2 class="h5">Product Details (JSON)</h2>
            <pre id="resultArea" class="bg-light p-3 border rounded">JSON</pre>
        </section>
    </div>

    <script>
    document.getElementById('returnHome').addEventListener('click', function () { window.location.href = 'index.html'; });

    // Submit new product
    document.getElementById('ProductForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const product = {
            id: document.getElementById('productID').value.trim(),
            name: document.getElementById('productName').value.trim(),
            description: document.getElementById('productDescription').value.trim(),
            category: document.getElementById('productCategory').value,
            uom: document.getElementById('productUnitofMeasure').value,
            price: document.getElementById('productPrice').value.trim(),
            weight: document.getElementById('productWeight').value.trim()
        };

        if (!product.id || !product.name || !product.price) {
            alert('Please fill in required fields.');
            return;
        }

        // Display JSON locally
        document.getElementById('resultArea').textContent = JSON.stringify(product, null, 2);

        // --- NEW: POST to MongoDB ---
        fetch('/api/products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(product)
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                alert('✅ Product saved to MongoDB!');
                e.target.reset();
                // Also save to localStorage for the cart to see it (client-side requirement)
                let products = JSON.parse(localStorage.getItem('products')) || [];
                products.push(product);
                localStorage.setItem('products', JSON.stringify(products));
            } else {
                alert('❌ Server Error: ' + data.message);
            }
        })
        .catch(err => {
            console.error(err);
            alert('❌ Connection Error: ' + err.message);
        });
    });
    </script>
</body>
</html>

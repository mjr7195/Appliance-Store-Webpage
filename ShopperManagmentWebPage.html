<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Shopper Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{--bg:#f8f9fb;--card:#ffffff;--muted:#6c757d;--accent:#0d6efd;}
        body{background:var(--bg);padding:28px 12px;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
        .card-area{max-width:920px;margin:0 auto;background:linear-gradient(180deg,var(--card),#fbfbfd);border-radius:10px;padding:22px;box-shadow:0 8px 30px rgba(17,24,39,0.06);border:1px solid #e9eef5;}
        label.required::after{content:" *";color:#d63384}
    </style>
</head>
<body>
    <div class="card-area">
        <header class="mb-3"><h1>Enter shopper details below:</h1></header>
        <form id="ShopperForm" class="row g-3" novalidate>
            <div class="col-12 col-md-6">
                <label for="email" class="form-label required">Shopper Email</label>
                <input id="email" type="email" class="form-control" placeholder="joe@test.com" required>
            </div>
            <div class="col-12 col-md-6">
                <label for="name" class="form-label required">Shopper Name</label>
                <input id="name" type="text" class="form-control" placeholder="Jane Doe" required>
            </div>
            <div class="col-12 col-md-4">
                <label for="phone" class="form-label">Contact Phone</label>
                <input id="phone" type="tel" class="form-control" placeholder="(555) 555-5555">
            </div>
            <div class="col-12 col-md-4">
                <label for="age" class="form-label required">Age</label>
                <input id="age" type="number" class="form-control" min="0" max="150" placeholder="e.g. 34" required>
            </div>
            <div class="col-12 col-md-4">
                <label for="address" class="form-label required">Address</label>
                <input id="address" type="text" class="form-control" placeholder="123 Main St" required>
            </div>
            <div class="col-12"><button type="submit" class="btn btn-primary">Submit Shopper</button></div>
            <div class="col-12"><button type="button" class="btn btn-secondary" id="returnHome">Return to Home</button></div>
        </form>
    </div>
    <script>
        document.getElementById('ShopperForm').addEventListener('submit', function (e) {
            e.preventDefault();
            let formValid = true;
            const requiredFields = this.querySelectorAll('[required]');

            requiredFields.forEach(field => {
                if (field.value.trim() === '') {
                    formValid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!formValid) {
                alert('Please fill out all fields before submitting');
            } else {
                // Collect Data
                const shopperData = {
                    email: document.getElementById('email').value,
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    age: document.getElementById('age').value,
                    address: document.getElementById('address').value,
                    dateAdded: new Date().toISOString()
                };

                // --- NEW: POST to MongoDB ---
                fetch('/api/shoppers', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(shopperData)
                })
                .then(res => res.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('✅ Shopper added to MongoDB!');
                        document.getElementById('ShopperForm').reset();
                    } else {
                        alert('❌ Server Error: ' + data.message);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert('❌ Connection Error: ' + err.message);
                });
            }
        });

        // Helper scripts
        document.getElementById('phone').addEventListener('input', function() { this.value = this.value.replace(/\D/g, '').slice(0, 10); });
        document.getElementById('age').addEventListener('input', function() { 
            this.value = this.value.replace(/\D/g, ''); 
            if(this.value > 150) this.value = 150; 
        });
        document.getElementById('returnHome').addEventListener('click', function(){ window.location.href = 'index.html'; });
    </script>
</body>
</html>
